<div class="max-w-2xl mx-auto">
  <!-- Suspended User Warning -->
  <% if @user.suspended? %>
    <div class="bg-red-900/20 border border-red-800 text-red-200 p-4 mb-4 rounded-lg">
      <div class="flex items-center">
        <svg class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
        </svg>
        <span class="font-semibold">This account has been suspended</span>
      </div>
      <p class="mt-1 text-sm">Reason: <%= @user.suspend_reason.humanize %></p>
      <p class="text-xs text-red-400 mt-1">Suspended on: <%= @user.suspend_date&.strftime("%B %d, %Y") || "Unknown date" %></p>
    </div>
  <% end %>

  <!-- Cover Photo -->
  <div class="h-48 sm:h-52 bg-gray-800 relative overflow-hidden <% if @user.cover_picture.attached? %>cursor-pointer hover:opacity-90 transition-opacity<% end %>" 
       style="<% if @user.cover_picture.attached? %>background-image: url('<%= url_for(@user.cover_picture) %>'); background-size: cover; background-position: center;<% else %><% if @user.team.present? %>background: linear-gradient(135deg, <%= @user.team.color_primary %>, <%= @user.team.color_secondary %>);<% else %>background: linear-gradient(135deg, #374151, #1f2937);<% end %><% end %>"
       <% if @user.cover_picture.attached? %>
         data-controller="image-viewer"
         data-action="click->image-viewer#openViewer"
       <% end %>>
    <% if @user.cover_picture.attached? %>
      <%= image_tag url_for(@user.cover_picture), 
          class: "w-full h-full object-cover opacity-0", 
          data: { image_viewer_target: "image", action: "click->image-viewer#openViewer", image_url: url_for(@user.cover_picture) } %>
    <% end %>
  </div>

  <!-- Profile Content -->
  <div class="px-4 pb-4">
    <!-- Profile Picture & Action Buttons -->
     <div class="flex justify-between items-start -mt-20 mb-4">
       <!-- Profile Picture -->
       <div class="relative">
         <% if @user.profile_picture.attached? %>
           <div class="block w-24 h-24 rounded-full border-4 border-black bg-gray-800 overflow-hidden hover:opacity-90 transition-opacity cursor-pointer"
                data-controller="image-viewer"
                data-action="click->image-viewer#openViewer">
             <%= image_tag url_for(@user.profile_picture), 
                 class: "w-full h-full object-cover",
                 data: { image_viewer_target: "image", action: "click->image-viewer#openViewer", image_url: url_for(@user.profile_picture) } %>
           </div>
         <% else %>
           <div class="w-24 h-24 rounded-full border-4 border-black bg-gray-800 overflow-hidden flex items-center justify-center">
             <span class="text-2xl font-bold text-gray-400">
               <%= @user.username.first.upcase if @user.username.present? %>
             </span>
           </div>
         <% end %>
       </div>

      <!-- Action Buttons -->
      <div class="flex gap-2 mt-16">
        <% if defined?(@is_own_profile) && @is_own_profile == false %>
          <!-- Follow/Unfollow Button -->
          <div id="follow_button_<%= @user.id %>">
            <% if Current.user.following?(@user) %>
              <%= button_to "Following", user_unfollow_path(@user.username), method: :delete, 
                  class: "px-4 py-1.5 text-sm font-bold border border-gray-600 text-white bg-transparent hover:bg-red-600 hover:border-red-600 hover:text-white rounded-full transition-all duration-200",
                  data: { turbo_stream: true } %>
            <% else %>
              <%= button_to "Follow", user_follow_path(@user.username), method: :post, 
                  class: "px-4 py-1.5 text-sm font-bold bg-white text-black hover:bg-gray-200 rounded-full transition-all duration-200",
                  data: { turbo_stream: true } %>
            <% end %>
          </div>

          <!-- Message Button -->
          <% if can_message_user?(@user) %>
            <%= link_to start_conversation_with_user_path(@user.id), method: :post,
                class: "p-2 border border-gray-600 text-white hover:bg-gray-800 rounded-full transition-all duration-200",
                title: "Message" do %>
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
              </svg>
            <% end %>
          <% end %>

          <!-- More Options -->
          <div class="relative" data-controller="dropdown">
            <button data-action="click->dropdown#toggle" 
                    class="p-2 border border-gray-600 text-white hover:bg-gray-800 rounded-full transition-all duration-200">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path d="M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"></path>
              </svg>
            </button>
            <div data-dropdown-target="menu" 
                 class="hidden absolute right-0 mt-2 w-48 bg-black border border-gray-700 rounded-xl shadow-lg z-10"
                 id="dropdown_menu_<%= @user.id %>">
              <%= render 'shared/dropdown_menu', user: @user %>
            </div>
          </div>
        <% else %>
          <!-- Edit Profile Button -->
          <%= link_to "Edit profile", profile_edit_path, class: "px-4 py-1.5 text-sm font-bold border border-gray-600 text-white bg-transparent hover:bg-gray-800 rounded-full transition-all duration-200" %>
        <% end %>
      </div>
    </div>

    <!-- User Info -->
    <div class="mb-4">
      <!-- Name and Team Badge -->
      <div class="flex items-center gap-2 mb-1">
        <h1 class="text-xl font-bold text-white">
          <%= @user.full_name.present? ? @user.full_name : @user.username %>
        </h1>
        <% if @user.team.present? && @user.team.symbol_slug.present? %>
          <span class="px-2 py-0.5 text-xs font-bold rounded-full" style="background-color: <%= @user.team.color_primary %>; color: <%= @user.team.color_secondary %>;">
            <%= @user.team.symbol_slug.upcase %>
          </span>
        <% end %>
      </div>
      
      <!-- Username -->
      <p class="text-gray-500 text-sm mb-3">@<%= @user.username %></p>
      
      <!-- Bio -->
      <% if @user.bio.present? %>
        <p class="text-white text-sm mb-3 leading-relaxed"><%= @user.bio %></p>
      <% end %>
      
      <!-- Location, Website, Birth Date -->
      <div class="flex flex-wrap items-center gap-4 mb-3 text-sm text-gray-500">
        <% if @user.location.present? %>
          <div class="flex items-center gap-1">
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"></path>
            </svg>
            <span><%= @user.location %></span>
          </div>
        <% end %>
        
        <% if @user.website.present? %>
          <div class="flex items-center gap-1">
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 00-1.414 1.414 4 4 0 005.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 00-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd"></path>
            </svg>
            <%= link_to @user.website, @user.website, target: "_blank", class: "text-blue-400 hover:underline" %>
          </div>
        <% end %>
        
        <% if @user.birth_date.present? %>
          <div class="flex items-center gap-1">
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"></path>
            </svg>
            <span>Born <%= @user.birth_date.strftime("%B %d, %Y") %><% if @user.age.present? %> (Age <%= @user.age %>)<% end %></span>
          </div>
        <% end %>
        
        <div class="flex items-center gap-1">
          <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"></path>
          </svg>
          <span>Joined <%= @user.created_at.strftime("%B %Y") %></span>
        </div>
      </div>
      
      <!-- Followers & Following -->
       <div class="flex items-center gap-4 text-sm">
         <%= link_to user_follows_path(@user.username, tab: 'following'), class: "hover:underline" do %>
           <span class="text-white font-bold" id="following_count"><%= @user.following_count %></span>
           <span class="text-gray-500">Following</span>
         <% end %>
         
         <%= link_to user_follows_path(@user.username, tab: 'followers'), class: "hover:underline" do %>
           <span class="text-white font-bold" id="followers_count"><%= @user.followers_count %></span>
           <span class="text-gray-500">Followers</span>
         <% end %>
         
         <!-- Energy Indicator -->
         <% if @is_own_profile %>
           <%= link_to energy_path, class: "flex items-center gap-1 hover:underline", data: { turbo_frame: "_top" } do %>
             <svg class="w-4 h-4 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
               <path fill-rule="evenodd" d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z" clip-rule="evenodd"></path>
             </svg>
             <span class="text-white font-bold"><%= @user.energy %></span>
             <span class="text-gray-500">Energy</span>
           <% end %>
         <% else %>
           <div class="flex items-center gap-1">
             <svg class="w-4 h-4 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
               <path fill-rule="evenodd" d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z" clip-rule="evenodd"></path>
             </svg>
             <span class="text-white font-bold"><%= @user.energy %></span>
             <span class="text-gray-500">Energy</span>
           </div>
         <% end %>
       </div>
    </div>

    <!-- Navigation Tabs -->
    <%= turbo_frame_tag "profile_content" do %>
      <div class="border-b border-gray-800">
        <nav class="flex">
          <% if @is_own_profile %>
            <%= link_to profile_path(tab: 'posts', format: :html), 
                 class: "flex-1 text-center py-4 text-sm font-medium transition-colors #{params[:tab] == 'posts' || params[:tab].blank? ? 'text-white border-b-2 border-blue-500' : 'text-gray-500 hover:text-gray-300'}",
                 data: { turbo_frame: "profile_content" } do %>
               Posts
             <% end %>
             
             <%= link_to profile_path(tab: 'replies', format: :html), 
                 class: "flex-1 text-center py-4 text-sm font-medium transition-colors #{params[:tab] == 'replies' ? 'text-white border-b-2 border-blue-500' : 'text-gray-500 hover:text-gray-300'}",
                 data: { turbo_frame: "profile_content" } do %>
               Replies
             <% end %>
             
             <%= link_to profile_path(tab: 'likes', format: :html), 
                 class: "flex-1 text-center py-4 text-sm font-medium transition-colors #{params[:tab] == 'likes' ? 'text-white border-b-2 border-blue-500' : 'text-gray-500 hover:text-gray-300'}",
                 data: { turbo_frame: "profile_content" } do %>
               Likes
             <% end %>
          <% else %>
            <%= link_to user_profile_path(@user.username, tab: 'posts'), 
                 class: "flex-1 text-center py-4 text-sm font-medium transition-colors #{params[:tab] == 'posts' || params[:tab].blank? ? 'text-white border-b-2 border-blue-500' : 'text-gray-500 hover:text-gray-300'}",
                 data: { turbo_frame: "profile_content" } do %>
               Posts
             <% end %>
             
             <%= link_to user_profile_path(@user.username, tab: 'replies'), 
                 class: "flex-1 text-center py-4 text-sm font-medium transition-colors #{params[:tab] == 'replies' ? 'text-white border-b-2 border-blue-500' : 'text-gray-500 hover:text-gray-300'}",
                 data: { turbo_frame: "profile_content" } do %>
               Replies
             <% end %>
             
             <%= link_to user_profile_path(@user.username, tab: 'likes'), 
                 class: "flex-1 text-center py-4 text-sm font-medium transition-colors #{params[:tab] == 'likes' ? 'text-white border-b-2 border-blue-500' : 'text-gray-500 hover:text-gray-300'}",
                 data: { turbo_frame: "profile_content" } do %>
               Likes
             <% end %>
          <% end %>
        </nav>
      </div>

      <!-- Content Area -->
      <div class="mt-4">
        <% if @blocked_by_user %>
          <div class="text-center py-12">
            <svg class="mx-auto h-12 w-12 text-gray-600 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728L5.636 5.636m12.728 12.728L18.364 5.636 5.636 18.364" />
            </svg>
            <h3 class="text-lg font-medium text-gray-400 mb-2">You're blocked</h3>
            <p class="text-gray-500">You can't see this user's posts.</p>
          </div>
        <% elsif @user_blocks_current_user %>
          <div class="text-center py-12">
            <svg class="mx-auto h-12 w-12 text-gray-600 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728L5.636 5.636m12.728 12.728L18.364 5.636 5.636 18.364" />
            </svg>
            <h3 class="text-lg font-medium text-gray-400 mb-2">You have blocked this user</h3>
            <p class="text-gray-500">You won't see their posts in your timeline.</p>
          </div>
        <% else %>
          <!-- Posts Content -->
          <% if params[:tab] == 'followers' %>
            <% if @followers&.any? %>
              <div class="space-y-3">
                <% @followers.each do |follower| %>
                  <%= render 'shared/user_card', user: follower %>
                <% end %>
              </div>
            <% else %>
              <div class="text-center py-12">
                <svg class="mx-auto h-12 w-12 text-gray-600 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                </svg>
                <h3 class="text-lg font-medium text-gray-400 mb-2">No followers yet</h3>
                <p class="text-gray-500">When someone follows this account, they'll show up here.</p>
              </div>
            <% end %>
          <% elsif params[:tab] == 'following' %>
            <% if @following&.any? %>
              <div class="space-y-3">
                <% @following.each do |followed_user| %>
                  <%= render 'shared/user_card', user: followed_user %>
                <% end %>
              </div>
            <% else %>
              <div class="text-center py-12">
                <svg class="mx-auto h-12 w-12 text-gray-600 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                </svg>
                <h3 class="text-lg font-medium text-gray-400 mb-2">Not following anyone yet</h3>
                <p class="text-gray-500">When this account follows someone, they'll show up here.</p>
              </div>
            <% end %>
          <% else %>
            <!-- Posts, Replies, Likes Content -->
            <% if @posts&.any? %>
              <div class="space-y-0">
                <% @posts.each do |post| %>
                  <%= render 'posts/post', post: post %>
                <% end %>
              </div>
              
              <!-- Infinite Scroll Pagination -->
              <% unless @posts&.empty? || @blocked_by_user || params[:tab] == 'followers' %>
                <div id="pagination" class="my-4" data-controller="infinite-scroll" data-infinite-scroll-target="pagination" data-infinite-scroll-url-value="<%= @is_own_profile ? profile_path(tab: params[:tab] || 'posts', format: :turbo_stream, page: @pagy.next) : user_profile_path(@user.username, tab: params[:tab] || 'posts', format: :turbo_stream, page: @pagy.next) if @pagy.next %>">
                  <!-- Pagination without button - posts load automatically on scroll -->
                </div>
              <% end %>
            <% else %>
              <div class="text-center py-12">
                <svg class="mx-auto h-12 w-12 text-gray-600 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z" />
                </svg>
                <h3 class="text-lg font-medium text-gray-400 mb-2">No posts yet</h3>
                <p class="text-gray-500">
                  <% if @is_own_profile %>
                    Share your first post to get started!
                  <% else %>
                    When <%= @user.username %> posts, they'll show up here.
                  <% end %>
                </p>
              </div>
            <% end %>
          <% end %>
        <% end %>
      </div>
    <% end %>
  </div>
</div>
