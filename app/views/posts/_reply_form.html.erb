<%= turbo_frame_tag "reply_form" do %>
  <div class="border-b border-gray-800 pb-4 mb-4">
    <!-- Compact "Replying to" indicator -->
    <div class="text-gray-400 mb-3 text-sm flex items-center">
      <span class="mr-1">‚Ü©Ô∏è</span> Replying to @<%= post.user.username %>
    </div>
    
    <%= form_with model: reply_post, url: reply_post_path(post), local: false, data: { turbo_frame: "reply_form", controller: "mention image-paste" } do |form| %>
      <% if reply_post.errors.any? %>
        <div class="mb-3 p-3 bg-red-900 border border-red-700 rounded-lg">
          <h4 class="text-red-300 font-medium mb-1 text-sm">Please fix the following errors:</h4>
          <ul class="text-red-300 text-sm">
            <% reply_post.errors.full_messages.each do |message| %>
              <li>‚Ä¢ <%= message %></li>
            <% end %>
          </ul>
        </div>
      <% end %>
      
      <!-- Compact reply form -->
      <div class="flex items-start space-x-3">
        <!-- Small avatar -->
        <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-bold text-sm flex-shrink-0">
          <%= Current.user.username.first.upcase %>
        </div>
        
        <!-- Form content -->
        <div class="flex-1">
          <!-- Compact text area -->
          <div class="mb-3 relative">
            <%= form.text_area :text, 
                placeholder: "Post your reply",
                class: "w-full p-3 bg-black border border-gray-800 rounded-xl resize-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-white placeholder-gray-500 text-base transition-all duration-200",
                rows: 1,
                id: "reply_textarea",
                data: { 
                  auto_expand: true,
                  min_rows: 1,
                  max_rows: 6,
                  mention_target: "textarea",
                  image_paste_target: "textarea"
                } %>
            
            <!-- Mention √∂nerileri i√ßin container -->
            <div data-mention-target="suggestions" class="hidden"></div>
            
            <!-- Image preview container -->
            <div class="image-preview-container mt-3 hidden"></div>
          </div>
          
          <!-- Hidden file input -->
          <div class="hidden">
            <%= form.file_field :images, 
                id: "reply_images_input",
                accept: "image/*",
                multiple: true,
                data: { image_paste_target: "fileInput" } %>
          </div>
          
          <!-- Hidden visibility select -->
          <div class="hidden">
            <%= form.select :visibility, 
                options_for_select([['üåç Everyone', 'everyone'], ['üë• Followers', 'followers'], ['üîí Only Me', 'only_me']], reply_post.visibility),
                {}, 
                { id: "reply_visibility_select" } %>
          </div>
          
          <!-- Compact action bar -->
          <div class="flex items-center justify-between">
            <!-- Left side - Media and formatting icons -->
            <div class="flex items-center space-x-1">
              <!-- Image upload icon -->
              <button type="button" 
                      onclick="document.getElementById('reply_images_input').click()" 
                      class="p-2 text-blue-400 hover:bg-blue-900 hover:bg-opacity-20 rounded-full transition-colors"
                      title="Add photos">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd" />
                </svg>
              </button>
              
              <!-- GIF icon (placeholder) -->
              <button type="button" 
                      class="p-2 text-blue-400 hover:bg-blue-900 hover:bg-opacity-20 rounded-full transition-colors"
                      title="Add GIF">
                <span class="text-sm font-bold">GIF</span>
              </button>
              
              <!-- Emoji icon (placeholder) -->
              <button type="button" 
                      class="p-2 text-blue-400 hover:bg-blue-900 hover:bg-opacity-20 rounded-full transition-colors"
                      title="Add emoji">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM7 9a1 1 0 100-2 1 1 0 000 2zm7-1a1 1 0 11-2 0 1 1 0 012 0zm-.464 5.535a1 1 0 10-1.415-1.414 3 3 0 01-4.242 0 1 1 0 00-1.415 1.414 5 5 0 007.072 0z" clip-rule="evenodd" />
                </svg>
              </button>
              
              <!-- Location icon (placeholder) -->
              <button type="button" 
                      class="p-2 text-blue-400 hover:bg-blue-900 hover:bg-opacity-20 rounded-full transition-colors"
                      title="Add location">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd" />
                </svg>
              </button>
            </div>
            
            <!-- Right side - Reply button -->
            <div class="flex items-center space-x-2">
              <!-- Character count (placeholder) -->
              <span class="text-sm text-gray-500" id="char_count"></span>
              
              <%= form.submit "Reply", 
                  class: "px-4 py-1.5 bg-blue-600 text-white rounded-full hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:ring-offset-black transition-colors font-semibold text-sm disabled:opacity-50" %>
            </div>
          </div>
        </div>
      </div>
    <% end %>
  </div>
<% end %>