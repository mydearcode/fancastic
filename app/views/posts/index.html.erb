<div class="max-w-2xl mx-auto p-4">
  <!-- Post Creation Form -->
  <div class="bg-white rounded-lg shadow-md p-6 mb-6">
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-xl font-bold">What's happening?</h2>
      
      <!-- Energy Bar -->
      <div class="flex items-center space-x-2">
        <span class="text-sm font-medium text-gray-600">Energy:</span>
        <div class="w-24 bg-gray-200 rounded-full h-2.5">
          <div class="bg-green-600 h-2.5 rounded-full <%= 'bg-yellow-500' if Current.user.energy < 50 %> <%= 'bg-red-500' if Current.user.energy < 20 %>" style="width: <%= Current.user.energy %>%"></div>
        </div>
        <span class="text-sm text-gray-500"><%= Current.user.energy %>/100</span>
      </div>
    </div>
    
    <%= form_with model: @post, local: true, class: "space-y-4" do |form| %>
      <% if @post.errors.any? %>
        <div class="bg-red-50 border border-red-200 rounded-md p-4">
          <h3 class="text-red-800 font-medium">Please fix the following errors:</h3>
          <ul class="mt-2 text-red-700 text-sm list-disc list-inside">
            <% @post.errors.full_messages.each do |message| %>
              <li><%= message %></li>
            <% end %>
          </ul>
        </div>
      <% end %>

      <div>
        <%= form.text_area :text, placeholder: "Share your thoughts...", 
            class: "w-full p-3 border border-gray-300 rounded-lg resize-none focus:ring-2 focus:ring-blue-500 focus:border-transparent", 
            rows: 3 %>
      </div>

      <div class="flex justify-between items-center">
        <div class="flex space-x-4">
          <%= form.select :visibility, 
              options_for_select(Post.visibilities.map { |key, value| [key.humanize, key] }, 'everyone'),
              {},
              { class: "px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500" } %>
        </div>
        
        <% if Current.user.can_perform_action?('post') %>
          <%= form.submit "Post (-5 Energy)", class: "bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg font-medium transition-colors" %>
        <% else %>
          <button type="button" disabled class="bg-gray-400 text-white px-6 py-2 rounded-lg font-medium cursor-not-allowed">
            Not Enough Energy (-5 Energy)
          </button>
        <% end %>
      </div>
    <% end %>
  </div>

  <!-- Posts Feed -->
  <div class="space-y-4">
    <% if @posts.any? %>
       <div id="posts">
         <% @posts.each do |post| %>
           <%= render 'post', post: post %>
         <% end %>
       </div>
     <% else %>
      <div class="text-center py-12">
        <h3 class="text-xl font-medium text-gray-900 mb-2">No posts yet</h3>
        <p class="text-gray-500">Be the first to share something!</p>
      </div>
    <% end %>
  </div>
</div>
</div>
